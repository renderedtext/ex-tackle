version: v1.0
name: Ex-tackle tests
agent:
  machine:
    type: e2-standard-2
    os_image: ubuntu2204

global_job_config:
  epilogue:
    always:
      commands:
        - if [ -f out/results.xml ]; then test-results publish out/results.xml --name "Elixir $ELIXIR_VERSION"; fi

blocks:
  - name: "Tests"
    task:
      jobs:
        - name: Lint
          env_vars:
            - name: ELIXIR_VERSION
              value: "1.14"
          commands:
            - checkout
            - make format.check

        - name: Testing
          matrix:
            - env_var: ELIXIR_VERSION
              values:
                [
                  "1.6",
                  "1.7",
                  "1.8",
                  "1.9",
                  "1.10",
                  "1.11",
                  "1.12",
                  "1.13",
                  "1.14.0",
                ]
          commands:
            - checkout
            - make test

after_pipeline:
  task:
    jobs:
      - name: Submit Reports
        commands:
          - test-results gen-pipeline-report
